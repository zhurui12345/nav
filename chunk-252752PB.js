import{a as te}from"./chunk-VR2WSGHG.js";import{b as G}from"./chunk-VBMQGA2H.js";import"./chunk-V2QEHFQP.js";import{i as j}from"./chunk-FS2Y7ZZ5.js";import"./chunk-JVALCBZP.js";import{ja as _,mc as K,nc as X,pc as Y,qc as Z,uc as ee}from"./chunk-IIHL3SUF.js";import{$b as O,Bc as Q,Ce as h,Dc as H,Yb as x,Zb as P,_b as I,gc as $,hb as M,jc as A,lb as z,qb as B,qc as F,rc as V,sc as W,te as J,wb as R,xa as D,ya as C,ze as U}from"./chunk-A5Z46WWS.js";var f=J(),b=n=>(n.textContent||"").trim(),ie=n=>(n.getAttribute("href")||"").trim(),w=n=>(n.getAttribute("icon")||"").trim();function L(n){let a=[];return Array.from(n.children).forEach(e=>{if(e.nodeName==="DT"){let r=e.firstElementChild;r?.nodeName==="A"&&a.push({name:b(r),icon:w(r),url:ie(r),tags:[],desc:"",rate:5,id:f+=1,breadcrumb:[]})}}),a}function oe(n){let a=JSON.parse(JSON.stringify(U())),e=[],p=new DOMParser().parseFromString(n,"text/html"),N=n.includes('PERSONAL_TOOLBAR_FOLDER="true"')?"body dl dl":"body dl",g=p.querySelector(N);if(!g)return{message:"\u672A\u627E\u5230dl dl\u8282\u70B9"};try{let y=function(l,c){Array.from(l.children).forEach(t=>{if(t.nodeName==="DT"){let o=t.querySelector("a");o&&c.nav.push({name:b(o),url:ie(o),desc:"",tags:[],rate:5,top:!1,icon:w(o),id:f+=1,breadcrumb:[]})}})},u=function(l,c){Array.from(l.children).forEach((t,o)=>{if(t.nodeName==="DT"){let d=t.querySelector("h3");if(d){let i=b(d);c.nav.some(T=>T.title===i)&&(i=i+o);let m={id:f+=1,title:i,nav:[],icon:""};c.nav.push(m);let S=t.querySelector("dl");S&&y(S,m)}}})},k=function(l,c){Array.from(l.children).forEach((t,o)=>{if(t.nodeName==="DT"){let d=t.querySelector("h3");if(d){let i=b(d);c.nav.some(T=>T.title===i)&&(i=i+o);let m={id:f+=1,title:i,icon:w(d),nav:[]};c.nav.push(m);let S=t.querySelector("dl");if(S){let T=L(S);T.length>0&&m.nav.push({id:f+=1,title:i,icon:"",nav:T}),u(S,m)}}}})};var ne=y,se=u,ae=k;Array.from(g.children).forEach((l,c)=>{if(l.nodeName==="DT"){let t=l.querySelector("h3");if(t){let o=b(t);e.some(m=>m.title===o)&&(o=o+c);let i={id:f+=1,title:o,icon:w(t),nav:[]};e.push(i);let E=l.querySelector("dl");if(E){let m=L(E);m.length>0&&i.nav.push({id:f+=1,title:o,icon:"",nav:[{id:f+=1,title:o,icon:"",nav:m}]}),k(E,i)}}}});let s=L(g);s.length>0&&e.push({id:f+=1,title:h("_uncategorized"),icon:"",nav:[{id:f+=1,title:h("_uncategorized"),icon:"",nav:[{id:f+=1,title:h("_uncategorized"),icon:"",nav:s}]}]})}catch(y){throw console.log(y),y}function v(y,u){for(let k=0;k<y.length;k++){let s=y[k],l=(s.title||_(s.url)).trim(),c=u.findIndex(t=>(t.title||_(t.url)).trim()===l);if(c!==-1)Array.isArray(s.nav)&&v(s.nav,u[c].nav);else{let t=_((s.url||"").trim());s.url&&(u.some(i=>_(i.url).trim()===t)||u.push(s));let o=(s.title||"").trim();s.title&&(u.some(i=>i.title?.trim()===o)||u.push(s))}}}return v(e,a),a}var re=["file"],q=class n{constructor(a,e){this.message=a;this.notification=e}file;$t=h;ngOnInit(){}onClickFile(){this.file.nativeElement.click()}onBookChange(a){let e=this,{files:r}=a.target;if(r.length<=0)return;let p=r[0],N=new FileReader;N.readAsText(p),N.onload=function(){let g=this.result;try{let v=oe(g);Array.isArray(v)?(e.message.success(h("_importSuccess")),G(v),setTimeout(()=>window.location.reload(),2e3)):e.notification.error(h("_errorBookTip"),`${v?.message??""}`)}catch(v){e.notification.error(h("_errorBookTip"),`${v.message}`)}a.target.value=""}}static \u0275fac=function(e){return new(e||n)(B(ee),B(te))};static \u0275cmp=R({type:n,selectors:[["system-bookmark"]],viewQuery:function(e,r){if(e&1&&F(re,5),e&2){let p;V(p=W())&&(r.file=p.first)}},decls:6,vars:2,consts:[["file",""],[1,"text-center","mt-10"],[1,"mb-4",3,"innerHTML"],["nz-button","","nzType","primary",3,"click"],["type","file","accept","text/html",1,"!hidden",3,"change"]],template:function(e,r){if(e&1){let p=$();P(0,"div",1),O(1,"div",2),P(2,"button",3),A("click",function(){return D(p),C(r.onClickFile())}),Q(3),I(),P(4,"input",4,0),A("change",function(g){return D(p),C(r.onBookChange(g))}),I()()}e&2&&(z(),x("innerHTML",r.$t("_importEnter"),M),z(2),H(" ",r.$t("_upload")," "))},dependencies:[j,Z,Y,K,X],encapsulation:2})};export{q as default};
